# 医疗语音助手系统 - 双端实现总结

## 🎉 已完成功能

### ✅ 1. 患者端导诊模块
**文件：** `server/modules/triage.py`

**功能：**
- 根据症状自动推荐就诊科室
- 支持年龄、性别等个性化因素
- 识别紧急情况并优先推荐急诊
- 从患者描述中自动提取症状信息

**API接口：**
```
POST /patient/triage - 智能导诊
POST /patient/collect-info - 信息提取
GET /departments/list - 科室列表
```

**使用示例：**
```python
# 患者：8岁男孩，发烧、咳嗽、头痛
response = requests.post(
    "http://localhost:6007/patient/triage",
    json={
        "symptoms": ["发烧", "咳嗽", "头痛"],
        "age": 8,
        "gender": "男"
    }
)
# 推荐：呼吸内科或儿科
```

### ✅ 2. 医生端辅助诊断模块
**文件：** `server/modules/diagnosis_assistant.py`

**功能：**
- 症状分析与疾病推断
- 计算疾病匹配置信度
- 生成诊断建议和需要询问的问题
- 鉴别诊断（对比多个疾病）
- 识别危急情况并发出警告

**API接口：**
```
POST /doctor/analyze-symptoms - 症状分析
POST /doctor/differential-diagnosis - 鉴别诊断
```

**使用示例：**
```python
# 医生输入症状：高热、肌肉酸痛、乏力
response = requests.post(
    "http://localhost:6007/doctor/analyze-symptoms",
    json={
        "symptoms": ["高热", "头痛", "肌肉酸痛", "乏力"],
        "patient_info": {"age": 35, "gender": "男"}
    }
)
# 返回：
# - 流行性感冒 (85% 置信度)
# - 普通感冒 (45% 置信度)
# - 诊断建议：高度符合流感特征，建议病毒检测
```

### ✅ 3. 用药查询管理模块
**文件：** `server/modules/medication.py`

**功能：**
- 药品信息查询（用法用量、禁忌症、副作用）
- 药物相互作用检查
- 个性化剂量建议（考虑年龄、体重、肝肾功能）
- 禁忌症检查（过敏史、疾病史）
- 根据适应症搜索药品

**API接口：**
```
POST /medication/query - 查询药品
POST /medication/check-interactions - 检查相互作用
POST /medication/dosage-recommendation - 剂量建议
POST /medication/check-contraindications - 禁忌症检查
POST /medication/search-by-indication - 按适应症搜索
```

**使用示例：**
```python
# 1. 查询药品
response = requests.post(
    "http://localhost:6007/medication/query",
    json={"medication": "阿莫西林"}
)

# 2. 检查药物相互作用
response = requests.post(
    "http://localhost:6007/medication/check-interactions",
    json={"medications": ["二甲双胍", "布洛芬"]}
)
# 返回警告：NSAIDs可能影响肾功能，增加乳酸酸中毒风险

# 3. 老年患者剂量建议
response = requests.post(
    "http://localhost:6007/medication/dosage-recommendation",
    json={
        "medication": "氨氯地平",
        "patient_info": {"age": 72, "weight": 65}
    }
)
# 返回：起始剂量应减半（2.5mg）
```

### ✅ 4. 医疗知识库
**文件：** `config/medical_knowledge.json`

**包含：**
- **科室信息**：15个科室（内科、外科、儿科、妇科等）
- **疾病数据**：8种常见疾病（感冒、流感、胃炎、高血压、糖尿病、肺炎等）
  - 症状列表、典型症状
  - 病因、诊断方法
  - 治疗方案、推荐药物
  - 预防措施
- **药品信息**：6种常用药物（阿莫西林、布洛芬、二甲双胍、氨氯地平、奥美拉唑、阿司匹林）
  - 适应症、用法用量
  - 禁忌症、副作用
  - 注意事项、储存条件
- **药物相互作用**：5组常见相互作用

### ✅ 5. 配置优化
**文件：** `config/config.yaml`

**更新：**
- 扩充医疗热词（35+个医疗相关词汇）
- 优化系统提示词（区分患者/医生角色）
- 添加医疗场景专业指导

---

## 🎯 系统架构

```
┌─────────────────────────────────────────────────┐
│          医疗语音助手系统                          │
├─────────────────────────────────────────────────┤
│                                                 │
│  ┌──────────────┐         ┌──────────────┐    │
│  │   患者端      │         │   医生端      │    │
│  └──────┬───────┘         └──────┬───────┘    │
│         │                        │             │
│         ▼                        ▼             │
│  ┌──────────────┐         ┌──────────────┐    │
│  │ 智能导诊模块  │         │ 辅助诊断模块  │    │
│  │ (Triage)     │         │ (Diagnosis)   │    │
│  └──────────────┘         └──────────────┘    │
│                                                 │
│              ┌──────────────┐                  │
│              │ 用药管理模块  │                  │
│              │ (Medication)  │                  │
│              └──────────────┘                  │
│                                                 │
│  ┌─────────────────────────────────────────┐  │
│  │        医疗知识库                        │  │
│  │  - 疾病信息  - 症状数据                  │  │
│  │  - 药品信息  - 科室数据                  │  │
│  └─────────────────────────────────────────┘  │
│                                                 │
│  ┌─────────────────────────────────────────┐  │
│  │        基础AI能力                        │  │
│  │  - 语音识别(ASR)  - 情感识别            │  │
│  │  - 声纹识别       - 对话生成            │  │
│  │  - 语音合成(TTS)  - 知识检索(RAG)       │  │
│  └─────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
```

---

## 📊 功能对比表

| 功能 | 患者端 | 医生端 |
|------|--------|--------|
| **导诊推荐** | ✓ | - |
| **症状收集** | ✓ | - |
| **症状分析** | - | ✓ |
| **疾病推断** | - | ✓ |
| **鉴别诊断** | - | ✓ |
| **用药查询** | ✓ | ✓ |
| **剂量建议** | - | ✓ |
| **相互作用检查** | - | ✓ |
| **禁忌症检查** | - | ✓ |
| **语音交互** | ✓ | ✓ |
| **情感关怀** | ✓ | - |

---

## 🚀 如何使用

### 1. 启动服务器
```bash
cd server
python app.py
# 服务器将运行在 http://localhost:6007
```

### 2. 测试功能
```bash
# 运行完整测试
python test_medical_features.py

# 或使用curl测试单个接口
curl -X POST http://localhost:6007/patient/triage \
  -H "Content-Type: application/json" \
  -d '{"symptoms": ["发烧", "咳嗽"], "age": 8}'
```

### 3. 集成到客户端
患者和医生可以通过语音或文字与系统交互：
```
患者: "我发烧了，还咳嗽"
系统: 提取症状 → 推荐科室 → "建议您去呼吸内科就诊"

医生: "患者高热、肌肉酸痛、乏力"
系统: 症状分析 → 疾病推断 → "高度疑似流感，建议病毒检测"
```

---

## 💡 使用场景示例

### 场景1：患者自助导诊
```
患者（通过语音）：
"我这几天一直发烧，还有头痛和咳嗽，不知道该挂什么科"

系统处理：
1. ASR语音识别
2. 提取症状：发烧、头痛、咳嗽
3. 导诊分析
4. TTS语音回复："根据您的症状，建议您去呼吸内科就诊"
```

### 场景2：医生辅助诊断
```
医生（通过界面输入）：
症状：高热、头痛、肌肉酸痛、乏力、咳嗽
患者信息：35岁男性

系统分析：
┌─────────────────────────────────┐
│ 可能疾病：                       │
│ 1. 流行性感冒 (85% 置信度)       │
│    - 典型症状高度匹配             │
│    - 建议：流感快速检测           │
│                                  │
│ 2. 普通感冒 (45% 置信度)         │
│    - 症状较重，不太典型           │
│                                  │
│ 需要询问：                       │
│ - 是否接触过流感患者？           │
│ - 症状持续多久了？               │
│                                  │
│ 推荐治疗：                       │
│ - 奥司他韦（抗病毒）             │
│ - 布洛芬（退热）                 │
└─────────────────────────────────┘
```

### 场景3：用药安全检查
```
医生开处方：
- 二甲双胍（降糖）
- 布洛芬（镇痛）
- 阿司匹林（抗血小板）

系统检查：
⚠️ 警告：发现2个药物相互作用

1. 二甲双胍 + 布洛芬
   严重程度：中度
   风险：NSAIDs可能影响肾功能，增加乳酸酸中毒风险
   建议：监测肾功能

2. 阿司匹林 + 布洛芬
   严重程度：中度
   风险：降低阿司匹林心血管保护作用
   建议：调整服药时间间隔

✓ 针对72岁老年患者：
   建议降低起始剂量
```

---

## 📝 待扩展功能

### 短期（1-2周）
- [ ] 增加更多疾病和药品数据
- [ ] 支持多轮问诊对话
- [ ] 健康档案管理（基于声纹识别）
- [ ] 用药提醒功能

### 中期（1个月）
- [ ] 影像学报告解读
- [ ] 检验结果分析
- [ ] 慢性病管理
- [ ] 复诊提醒

### 长期（2-3个月）
- [ ] 与电子病历系统对接
- [ ] 远程医生咨询
- [ ] AI生成诊疗报告
- [ ] 数据可视化分析

---

## ⚠️ 重要声明

1. **医疗免责**：本系统仅供辅助参考，不能替代专业医生的诊断和治疗
2. **数据安全**：实际部署时需要加密存储患者数据，符合医疗数据保护法规
3. **紧急情况**：系统会识别危急症状并提示立即就医
4. **持续更新**：医疗知识库需要定期更新以保证准确性

---

## 📚 相关文档

- [API文档_医疗功能.md](./API文档_医疗功能.md) - 详细API接口说明
- [医疗功能实现建议.md](./医疗功能实现建议.md) - 功能设计建议
- [test_medical_features.py](./test_medical_features.py) - 功能测试脚本

---

## 🎓 技术栈

- **后端框架**：Flask
- **AI模型**：
  - ASR: Paraformer-Large
  - 情感: SenseVoice
  - 对话: Qwen2.5-0.5B-Instruct
  - 声纹: CAM++
  - TTS: CosyVoice
- **知识检索**：RAG + BGE-small-zh
- **医疗模块**：自研算法 + 知识库匹配

---

## ✨ 项目亮点

1. **双端设计**：同时服务患者和医生，各有侧重
2. **智能导诊**：自动推荐科室，提高就诊效率
3. **辅助诊断**：基于症状匹配，提供疾病推断
4. **用药安全**：检查相互作用和禁忌症
5. **个性化**：考虑年龄、性别、肝肾功能等因素
6. **语音交互**：全程语音操作，老年人友好
7. **知识驱动**：基于结构化医疗知识库

---

**开发完成日期**：2025年12月26日
**版本**：v1.0
